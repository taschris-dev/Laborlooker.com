{% extends "base.html" %}

{% block title %}User Ratings - {{ user.email.split('@')[0] }} - LaborLooker{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h2>User Ratings</h2>
            <p class="lead">Ratings and reviews for {{ user.email.split('@')[0] }}</p>
            
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <h1 class="display-4 text-warning">
                                {% if rating_summary.average > 0 %}
                                {{ "%.1f"|format(rating_summary.average) }}
                                {% else %}
                                New User
                                {% endif %}
                            </h1>
                            {% if rating_summary.average > 0 %}
                            <div class="rating-display mb-2">
                                {% for i in range(1, 6) %}
                                    {% if i <= rating_summary.average %}
                                        <span class="star filled">‚òÖ</span>
                                    {% elif i - 0.5 <= rating_summary.average %}
                                        <span class="star half">‚òÜ</span>
                                    {% else %}
                                        <span class="star empty">‚òÜ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p class="text-muted">{{ rating_summary.count }} rating{{ 's' if rating_summary.count != 1 else '' }}</p>
                            {% else %}
                            <p class="text-success">üåü New to the platform</p>
                            <p class="text-muted">No ratings yet</p>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-8">
                            {% if rating_summary.count > 0 %}
                            <h5>Rating Breakdown</h5>
                            {% for star in range(5, 0, -1) %}
                            <div class="rating-bar mb-2">
                                <div class="row align-items-center">
                                    <div class="col-2">
                                        <small>{{ star }} star{{ 's' if star != 1 else '' }}</small>
                                    </div>
                                    <div class="col-8">
                                        <div class="progress">
                                            {% set percentage = (rating_summary.breakdown[star] / rating_summary.count * 100) if rating_summary.count > 0 else 0 %}
                                            <div class="progress-bar bg-warning" style="width: {{ percentage }}%"></div>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <small>{{ rating_summary.breakdown[star] }}</small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="text-center">
                                <i class="fas fa-star fa-3x text-muted mb-3"></i>
                                <h5>New User</h5>
                                <p class="text-muted">This user is new to LaborLooker and hasn't received any ratings yet. New users get a slight priority boost to help them get started!</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            {% if rating_summary.recent_reviews %}
            <div class="mt-4">
                <h5>Recent Reviews</h5>
                {% for review in rating_summary.recent_reviews %}
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="rating-display mb-2">
                                    {% for i in range(1, 6) %}
                                        {% if i <= review.rating %}
                                            <span class="star filled">‚òÖ</span>
                                        {% else %}
                                            <span class="star empty">‚òÜ</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <p class="mb-1">{{ review.comment }}</p>
                                <small class="text-muted">
                                    by {{ review.rater_name }} ‚Ä¢ {{ review.date.strftime('%B %d, %Y') }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="mt-4">
                <a href="javascript:history.back()" class="btn btn-outline-primary">
                    ‚Üê Back
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.rating-display .star {
    font-size: 1.2rem;
    margin-right: 2px;
}

.star.filled {
    color: #ffc107;
}

.star.empty {
    color: #dee2e6;
}

.star.half {
    color: #ffc107;
}

.rating-bar .progress {
    height: 8px;
}
</style>
{% endblock %}