{% extends 'base.html' %}
{% block content %}
<div class="flex justify-between items-center mb-6">
<h1 class="text-2xl font-semibold">Prospects & Leads Management</h1>
<a href="/prospects/new" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add Prospect</a>
</div>

<!-- Summary Stats -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Total Prospects</div>
    <div class="text-2xl font-bold text-blue-600">{{ prospects|length }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">New Leads</div>
    <div class="text-2xl font-bold text-green-600">{{ prospects|selectattr("status", "equalto", "new")|list|length }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Qualified</div>
    <div class="text-2xl font-bold text-orange-600">{{ prospects|selectattr("status", "equalto", "qualified")|list|length }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Potential Value</div>
    <div class="text-2xl font-bold text-purple-600">${{ "%.0f"|format(prospects|sum(attribute="estimated_value")) }}</div>
</div>
</div>

<!-- Prospects Table -->
<div class="bg-white rounded shadow overflow-x-auto">
<table class="min-w-full">
<thead class="bg-gray-50">
<tr>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Name</th>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Client</th>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Contact</th>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Source</th>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Status</th>
    <th class="text-right p-3 text-sm font-medium text-gray-600">Est. Value</th>
    <th class="text-left p-3 text-sm font-medium text-gray-600">Added</th>
    <th class="text-center p-3 text-sm font-medium text-gray-600">Actions</th>
</tr>
</thead>
<tbody>
{% for prospect in prospects %}
<tr class="border-t hover:bg-gray-50">
    <td class="p-3">
    <div class="font-medium">{{ prospect.name }}</div>
    {% if prospect.address %}<div class="text-sm text-gray-500">{{ prospect.address }}</div>{% endif %}
    </td>
    <td class="p-3">{{ prospect.client.name }}</td>
    <td class="p-3 text-sm">
    {% if prospect.email %}<div>{{ prospect.email }}</div>{% endif %}
    {% if prospect.phone %}<div>{{ prospect.phone }}</div>{% endif %}
    </td>
    <td class="p-3">
    <span class="inline-block px-2 py-1 text-xs rounded bg-gray-100 text-gray-700 capitalize">
        {{ prospect.source or 'manual' }}
    </span>
    </td>
    <td class="p-3">
    <span class="inline-block px-2 py-1 text-xs rounded 
        {% if prospect.status == 'new' %}bg-blue-100 text-blue-700
        {% elif prospect.status == 'contacted' %}bg-yellow-100 text-yellow-700
        {% elif prospect.status == 'qualified' %}bg-green-100 text-green-700
        {% elif prospect.status == 'scheduled' %}bg-purple-100 text-purple-700
        {% elif prospect.status == 'won' %}bg-green-100 text-green-800
        {% elif prospect.status == 'lost' %}bg-red-100 text-red-700
        {% else %}bg-gray-100 text-gray-700{% endif %}">
        {{ prospect.status.title() }}
    </span>
    </td>
    <td class="p-3 text-right">
    {% if prospect.estimated_value > 0 %}
        <span class="font-medium text-green-600">${{ "%.0f"|format(prospect.estimated_value) }}</span>
    {% else %}
        <span class="text-gray-400">$0</span>
    {% endif %}
    </td>
    <td class="p-3 text-sm text-gray-500">{{ prospect.created_at.strftime('%m/%d/%Y') }}</td>
    <td class="p-3 text-center">
    <div class="flex gap-2 justify-center">
        <a href="/prospects/{{ prospect.id }}/edit" 
           class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Edit</a>
        {% if prospect.status == 'qualified' %}
        <a href="/schedule/new?prospect_id={{ prospect.id }}" 
           class="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">Schedule</a>
        {% endif %}
    </div>
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

{% if not prospects %}
<div class="bg-white rounded shadow p-8 text-center">
<div class="text-gray-400 text-4xl mb-4">ðŸ‘¥</div>
<h3 class="text-lg font-medium text-gray-700 mb-2">No prospects yet</h3>
<p class="text-gray-500 mb-4">Start adding prospects and leads to track your sales pipeline</p>
<a href="/prospects/new" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add First Prospect</a>
</div>
{% endif %}

{% endblock %}