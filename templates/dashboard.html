{% extends 'base.html' %}
{% block content %}
<div class="flex justify-between items-center mb-4">
<h1 class="text-2xl font-semibold">Marketing Technology Dashboard</h1>
<div class="flex gap-2">
    {% if clients|length > 0 %}
    <a href="/demo/clear" onclick="return confirm('Are you sure you want to clear all data? This cannot be undone!')" 
       class="text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">Clear All Data</a>
    {% endif %}
    <a href="/demo/populate" class="text-sm bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700">Load Demo Data</a>
</div>
</div>

<!-- Key Metrics -->
<div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Total Clicks</div>
    <div class="text-2xl font-bold text-blue-600">{{ total_clicks }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Campaign Leads</div>
    <div class="text-2xl font-bold text-green-600">{{ total_leads }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Prospects</div>
    <div class="text-2xl font-bold text-purple-600">{{ total_prospects }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">New Prospects</div>
    <div class="text-2xl font-bold text-orange-600">{{ new_prospects }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Upcoming Work</div>
    <div class="text-2xl font-bold text-red-600">{{ upcoming_work }}</div>
</div>
<div class="bg-white p-4 rounded shadow">
    <div class="text-sm text-gray-500">Conversion Rate</div>
    <div class="text-2xl font-bold text-teal-600">{{ lead_conversion_rate }}%</div>
</div>
</div>

<!-- Campaign Types Analytics -->
<div class="bg-white rounded shadow mb-6">
<div class="p-4 border-b">
    <h2 class="font-medium">Campaign Performance by Type</h2>
</div>
<div class="p-4">
    {% if campaign_types %}
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
    {% for campaign_type, count in campaign_types %}
    <div class="text-center p-3 bg-gray-50 rounded">
        <div class="text-lg font-semibold">{{ count }}</div>
        <div class="text-sm text-gray-600 capitalize">{{ campaign_type.replace('_', ' ') }}</div>
    </div>
    {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-600">No campaign data yet.</p>
    {% endif %}
</div>
</div>

<!-- Quick Actions -->
<div class="bg-white rounded shadow mb-6">
<div class="p-4 border-b">
    <h2 class="font-medium">üöÄ Quick Actions</h2>
</div>
<div class="p-4">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <a href="/prospects/new" class="flex flex-col items-center p-4 border border-blue-200 rounded hover:bg-blue-50">
        <div class="text-2xl mb-2">üë•</div>
        <div class="text-sm font-medium">Add Prospect</div>
        <div class="text-xs text-gray-500">Manual lead entry</div>
    </a>
    <a href="/schedule/new" class="flex flex-col items-center p-4 border border-green-200 rounded hover:bg-green-50">
        <div class="text-2xl mb-2">üìÖ</div>
        <div class="text-sm font-medium">Schedule Work</div>
        <div class="text-xs text-gray-500">Book appointments</div>
    </a>
    <a href="/clients/new" class="flex flex-col items-center p-4 border border-purple-200 rounded hover:bg-purple-50">
        <div class="text-2xl mb-2">üè¢</div>
        <div class="text-sm font-medium">Add Client</div>
        <div class="text-xs text-gray-500">New business</div>
    </a>
    <a href="/campaigns/new" class="flex flex-col items-center p-4 border border-orange-200 rounded hover:bg-orange-50">
        <div class="text-2xl mb-2">üì¢</div>
        <div class="text-sm font-medium">New Campaign</div>
        <div class="text-xs text-gray-500">Marketing campaign</div>
    </a>
    </div>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- Clients Section -->
<div class="bg-white rounded shadow">
<div class="p-4 border-b">
    <div class="flex justify-between items-center">
    <h2 class="font-medium">Client Portfolio</h2>
    <a href="/clients/new" class="text-sm bg-blue-600 text-white px-3 py-1 rounded">Add Client</a>
    </div>
</div>
<div class="p-4">
{% if clients %}
<ul class="space-y-3">
{% for c in clients %}
<li class="border-l-4 border-blue-500 pl-3">
<div class="flex items-center justify-between">
    <div>
    <div class="font-medium">{{ c.name }}</div>
    <div class="text-sm text-gray-500">{{ c.industry or 'Industry not specified' }}</div>
    {% if c.website %}<div class="text-xs text-blue-600">{{ c.website }}</div>{% endif %}
    </div>
    <a class="text-sm bg-green-600 text-white px-2 py-1 rounded" href="/contacts/upload/{{ c.id }}">Upload CRM</a>
</div>
</li>
{% endfor %}
</ul>
{% else %}
<p class="text-gray-600">No clients yet. Start by adding your first local business client.</p>
{% endif %}
</div>
</div>

<!-- Campaigns Section -->
<div class="bg-white rounded shadow">
<div class="p-4 border-b">
    <div class="flex justify-between items-center">
    <h2 class="font-medium">Active Campaigns</h2>
    <a href="/campaigns/new" class="text-sm bg-blue-600 text-white px-3 py-1 rounded">New Campaign</a>
    </div>
</div>
<div class="p-4">
{% if campaigns %}
<ul class="space-y-3">
{% for cp in campaigns %}
<li class="border rounded p-3 {% if cp.campaign_type == 'referral' %}border-blue-200 bg-blue-50{% elif cp.campaign_type == 'direct_mail' %}border-green-200 bg-green-50{% elif cp.campaign_type == 'sticker' %}border-yellow-200 bg-yellow-50{% elif cp.campaign_type == 'media' %}border-purple-200 bg-purple-50{% else %}border-gray-200 bg-gray-50{% endif %}">
<div class="flex items-center justify-between">
    <div>
    <div class="font-medium">{{ cp.name }}</div>
    <div class="text-sm text-gray-600">{{ cp.client.name }} ‚Ä¢ {{ cp.campaign_type.replace('_', ' ').title() }}</div>
    <div class="text-sm text-gray-500">{{ cp.incentive or 'No incentive specified' }}</div>
    {% if cp.budget > 0 %}<div class="text-xs text-green-600">Budget: ${{ "%.2f"|format(cp.budget) }}</div>{% endif %}
    </div>
    <a class="text-sm bg-blue-600 text-white px-2 py-1 rounded" href="/campaigns/{{ cp.id }}">View</a>
</div>
</li>
{% endfor %}
</ul>
{% else %}
<p class="text-gray-600">No campaigns yet. Create your first marketing campaign to start tracking leads.</p>
{% endif %}
</div>
</div>
</div>

{% if recent_leads %}
<!-- Recent Activity -->
<div class="mt-6 bg-white rounded shadow">
<div class="p-4 border-b">
    <h2 class="font-medium">Recent Lead Activity</h2>
</div>
<div class="p-4">
<ul class="space-y-2">
{% for lead in recent_leads %}
<li class="flex items-center justify-between py-2 border-b border-gray-100">
    <div>
    <div class="font-medium">{{ lead.name or 'Anonymous Lead' }}</div>
    <div class="text-sm text-gray-500">{{ lead.email or lead.phone or 'No contact info' }} ‚Ä¢ {{ lead.ts.strftime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">{{ lead.status.title() }}</span>
</li>
{% endfor %}
</ul>
</div>
</div>
{% endif %}

{% endblock %}